name: iptv-upstream
on:
  # å½“ä»£ç æ¨é€åˆ°ä»“åº“æ—¶è§¦å‘ã€‚
  # push:
  #   # æŒ‡å®šæ–‡ä»¶è·¯å¾„ä¼šè§¦å‘å·¥ä½œæµç¨‹
  #   paths:
  #     - '.github/workflows/upstream.yml'
  #     - '.gitignore'
  #     - '.github/diy/**'
  # # æŒ‰è®¡åˆ’å®šæœŸè§¦å‘ï¼Œä¾‹å¦‚æ¯ 12 å°æ—¶ä¸€æ¬¡ã€‚
  # schedule:
  #   - cron: 0 */12 * * *
  # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµç¨‹ã€‚
  schedule:
    - cron: '30 21 */3 * *'
  workflow_dispatch:
    inputs:
      ssh:
        description: 'ssh'
        required: false
        default: 'false'
  # # å½“ä»“åº“è¢«å…³æ³¨æ—¶è§¦å‘ã€‚
  # watch:
  #   types: started
  # # é€šè¿‡å¤–éƒ¨äº‹ä»¶è§¦å‘ã€‚
  # repository_dispatch:

jobs:
  merge:
    runs-on: Ubuntu-22.04

    steps:
    - name: Checkout
      uses: actions/checkout@main
      with:
        fetch-depth: 0
    
    - name: Set git identity è®¾ç½®gitæ ‡è¯†
      run : |
        git config --global user.email "54346276+asxs123@users.noreply.github.com"
        git config --global user.name "github-actions[bot]"
        sudo timedatectl set-timezone "Asia/Shanghai"

    - name: Syn upstream  åŒæ­¥ä¸Šæ¸¸
      run: |
        rm -f tvboxlist/iptv.txt
        # æœ€å¤§é‡è¯•æ¬¡æ•°
        MAX_RETRIES=3
        # åˆå§‹é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
        RETRY_DELAY=3

        # å®šä¹‰M3Uè½¬æ¢å‡½æ•°
        convert_m3u_to_txt() {
          local m3u_content="$1"
          local output_content=""
          local current_group_title=""

          # æŒ‰è¡Œå¤„ç†M3Uå†…å®¹
          while IFS= read -r line; do
            line="${line#"${line%%[![:space:]]*}"}"  # å»é™¤è¡Œé¦–ç©ºæ ¼
            line="${line%"${line##*[![:space:]]}"}"  # å»é™¤è¡Œå°¾ç©ºæ ¼

            if [[ "$line" == "#EXTINF:"* ]]; then
              # æå– group-title
              if [[ "$line" =~ group-title=\"([^\"]*)\" ]]; then
                group_title="${BASH_REMATCH[1]}"
                if [ "$group_title" != "$current_group_title" ]; then
                  current_group_title="$group_title"
                  output_content+="$current_group_title,#genre#\n"
                fi
              fi

              # æå–é¢‘é“åç§°ï¼ˆç›´æ¥ä½¿ç”¨å†…ç½®å­—ç¬¦ä¸²æ“ä½œï¼‰
              name="${line##*,}"  # è·å–æœ€åä¸€ä¸ªé€—å·åçš„å†…å®¹
              name="${name#"${name%%[![:space:]]*}"}"  # å»é™¤è¡Œé¦–ç©ºæ ¼
              name="${name%"${name##*[![:space:]]}"}"  # å»é™¤è¡Œå°¾ç©ºæ ¼
            elif [[ "$line" =~ ^[a-zA-z]+://[^\s]* ]]; then
              # å¦‚æœæ˜¯URLè¡Œï¼Œå†™å…¥é¢‘é“åç§°å’ŒURL
              url="$line"
              output_content+="$name,$url\n"
            fi
          done <<< "$m3u_content"

          # è¿”å›è½¬æ¢åçš„å†…å®¹
          echo -e "$output_content"
        }

        while IFS= read -r url; do
          # å»é™¤å¯èƒ½å­˜åœ¨çš„Windowsæ¢è¡Œç¬¦
          url=$(echo "$url" | tr -d '\r')
          
          # åˆå§‹åŒ–é‡è¯•è®¡æ•°å™¨
          retries=0
          success=false

          while [ $retries -le $MAX_RETRIES ]; do
            # å‘é€è¯·æ±‚
            new_response=$(curl -Ls "$url" -w "%{http_code}") # åŒ…å«HTTPçŠ¶æ€ç 
            
            # åˆ†ç¦»HTTPçŠ¶æ€ç å’Œå“åº”ä½“
            http_code=${new_response: -3}
            body=${new_response%???}

            # æ£€æŸ¥æ˜¯å¦åŒ…å«é”™è¯¯ä¿¡æ¯æˆ–HTTPçŠ¶æ€ç å¼‚å¸¸
            if [[ "$body" == *"ChmlFrp-é”™è¯¯è­¦å‘Š"* || "$body" == *"ç›´æ’­æºä¸­è½‰ç«™"* || $http_code -ge 400 ]]; then
              echo "æ£€æµ‹åˆ°é”™è¯¯æˆ–HTTPçŠ¶æ€ç å¼‚å¸¸ï¼ˆå°è¯•æ¬¡æ•°: $((retries+1))/$MAX_RETRIESï¼‰"
              retries=$((retries+1))
              
              if [ $retries -lt $MAX_RETRIES ]; then
                sleep_time=$((RETRY_DELAY * retries)) # æŒ‡æ•°é€€é¿å»¶è¿Ÿ
                echo "ç­‰å¾… $sleep_time ç§’åé‡è¯•..."
                sleep $sleep_time
              fi
            else
              # æˆåŠŸè·å–æœ‰æ•ˆå†…å®¹
              if [[ "$body" == "#EXTM3U"* ]]; then
                # å¦‚æœæ˜¯M3Uæ ¼å¼ï¼Œè°ƒç”¨è½¬æ¢å‡½æ•°
                converted_content=$(convert_m3u_to_txt "$body")
                echo "$converted_content" >> tvboxlist/iptv.txt
              else
                # å¦‚æœä¸æ˜¯M3Uæ ¼å¼ï¼Œç›´æ¥å†™å…¥
                echo "$body" >> tvboxlist/iptv.txt
              fi
              echo >> tvboxlist/iptv.txt
              success=true
              break
            fi
          done

          # è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ä»æœªæˆåŠŸ
          if ! $success; then
            echo "å·²è·³è¿‡é“¾æ¥ï¼š$urlï¼ˆè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼‰" >&2
          fi

          # å›ºå®šé—´éš”ï¼ˆå¤„ç†å®Œä¸€ä¸ªé“¾æ¥åç­‰å¾…3ç§’ï¼‰
          sleep 3

        done < .github/workflows/iptv/iptvlist.txt

        awk -F, '
        $2 ~ /#genre#/ { 
            if ($1 ~ /å°‘å„¿|ç»å…¸å‰§åœº|å„¿ç«¥|æ­ªæ­ª|å’ªå’•|ç¾é£Ÿ|åŸ‹å †|è™ç‰™|è§‚å½±|æµ‹è¯•|ç›´æ’­|ç»å…¸å°å“|MTV|å¥³å›¢|æ˜¥æ™š|ä¸­å›½ä¹‹å£°|è½¦è½½|å½±è§†|æ–—é±¼|^æ•°å­—|çºªå½•ç‰‡é¢‘é“|æ­Œ|DJéŸ³ä¹|æ”¶éŸ³å¹¿æ’­|YYYé¢‘é“|ç”µå½±é¢‘é“.|å›½å†…å½±é™¢|ã€Œç”µå½±ã€|ç”µå½±è½®æ’­|è£¸çœ¼3D|ã€Œå‰§é›†ã€|ã€ŒåŠ¨ç”»ã€|ã€Œç»¼è‰ºã€|ã€ŒYYã€|ç”µå½±|æ¸¸æˆ|ç”µè§†å‰§|æ¸¸æˆé¢‘é“|æ¸¸æˆèµ›äº‹ğŸ‘‰å…¨ç½‘|å®šæœŸç»´æŠ¤/) {  # åŒ¹é…å¤šä¸ªåˆ†ç±»å
                skip = 1
            } else {
                skip = 0
                print
            }
            next
        } 
        !skip { print }
        ' tvboxlist/iptv.txt > tvboxlist/iptvFormatOutput.txt
        
        awk '
        BEGIN {
            # è®¾ç½®å­—æ®µåˆ†éš”ç¬¦ä¸ºç©ºæ ¼æˆ–é€—å·
            FS="[,]";
        }
        {
            # åˆå§‹åŒ–å˜é‡
            tvg_name = ""; url = "";

            # åŒ¹é… tvg-name="xxxx"
            if (match($0, /tvg-name="([^"]*)"/, arr)) {
                tvg_name = arr[1];
            }

            # åŒ¹é…ä¸åŒ…å« .png çš„ URL
            for (i = 1; i <= NF; i++) {
                if ($i ~ /^https?:\/\/[^ ]+/ && $i !~ /\.png/) {
                    url = $i;
                    break;
                }
            }

            # å¦‚æœæ‰¾åˆ° tvg-name å’Œ URLï¼Œåˆ™æ›¿æ¢æ•´è¡Œä¸º "tvg_name,url"
            if (tvg_name != "" && url != "") {
                print tvg_name "," url;
            } else {
                # å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œä¿ç•™åŸè¡Œ
                print $0;
            }
        }
        ' tvboxlist/iptvFormatOutput.txt > tvboxlist/iptvFormatOutput2.txt
        
        grep -v -e '#genre#' -e 'å¹¿æ’­' -e 'æ˜¥æ™š' tvboxlist/iptvFormatOutput2.txt > tvboxlist/iptvFormatOutput3.txt
        awk -F',' 'BEGIN{IGNORECASE=1} $1 !~ /DJ|YY|Radio/ {print}' tvboxlist/iptvFormatOutput3.txt > tvboxlist/iptvFormatOutput4.txt
        awk -F',' '{split($2, links, "#"); for (i in links) print $1 "," links[i]}' tvboxlist/iptvFormatOutput4.txt > tvboxlist/iptvFormatOutput5.txt
        
        perl -pe '
            chomp;  # å»æ‰è¡Œå°¾çš„æ¢è¡Œç¬¦
            s/^([^,]*)(,.*)/$1$2/;  # å°†è¡Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé€—å·å‰å’Œé€—å·å
            $first_part = $1;       # è·å–é€—å·å‰çš„éƒ¨åˆ†
            $rest = $2;             # è·å–é€—å·åçš„éƒ¨åˆ†

            # å¯¹é€—å·å‰çš„éƒ¨åˆ†è¿›è¡Œæ›¿æ¢æ“ä½œ
            $first_part =~ s/(?i)é«˜æ¸…(NO EPG)|\((.*?)\)|\[(.*?)\]|ã€Œ(.*?)ã€| |	|-é«˜æ¸…|è¶…é«˜æ¸…|é»‘é¾™æ±Ÿ\||ä¸­å¤®æ–°å½±-|ä¸­å¤®æ–°å½±|æ²³å—\||æ²³å—ï½œ|5.5M1080HEVC|7.5M1080HEVC|HEVC|æ ‡æ¸…|æ¹–å—-|4M1080|_6.8M1080_ç™¾è§†é€š|12M1080|2M1080|8M1080|7M1080|3.5M1080|3M1080|HD|2.5M1080|Max16M1080|4.5M1080|5M1080|åŒ—äº¬IPTV|576|720//g;
            $first_part =~ s/(?i)CETVæ—©æœŸæ•™è‚²/æ—©æœŸæ•™è‚²/g;
            $first_part =~ s/(?i)(newtv)/\U$1/g;
            $first_part =~ s/(?i)(cctv)/\U$1/g;
            $first_part =~ s/(?i)\QNEWTV-\E/NEWTV/g;
            $first_part =~ s/(?i)\Qæ²³å—æ™´å½©ä¸­åŸ\E/æ™´å½©ä¸­åŸ/g;
            $first_part =~ s/(?i)\Qæ²³å—ç›å½©ä¸­åŸ\E/æ™´å½©ä¸­åŸ/g;
            $first_part =~ s/(?i)\QNEWTVå“’å•µèµ›äº‹\E/å“’å•µèµ›äº‹/g;
            $first_part =~ s/(?i)\QNEWTVå“’å•µç”µç«\E/å“’å•µç”µç«/g;
            $first_part =~ s/(?i)\QNEWTVå¤®å¹¿è´­ç‰©\E/å¤®å¹¿è´­ç‰©/g;
            $first_part =~ s/(?i)\QNEWTVä¸­è§†è´­ç‰©\E/ä¸­è§†è´­ç‰©/g;
            $first_part =~ s/(?i)\QNEWTVä¼˜è´­ç‰©\E/ä¼˜è´­ç‰©/g;
            $first_part =~ s/(?i)\QNEWTVç›å½©ç«æŠ€\E/ç›å½©ç«æŠ€/g;
            $first_part =~ s/(?i)\QNEWTVç²¾å½©å½±è§†\E/ç²¾å½©å½±è§†/g;
            $first_part =~ s/(?i)\QNEWTVç›å½©é’å°‘\E/ç›å½©é’å°‘/g;
            $first_part =~ s/(?i)\Qæ²³å—è¡›è¦–\E/æ²³å—å«è§†/g;
            $first_part =~ s/(?i)\QNEWTVæ­¦æä¸–ç•Œ\E/NEWTVæ­¦åšä¸–ç•Œ/g;
            $first_part =~ s/(?i)\Qå‘¨å£æ‰¶æ²Ÿ\E/æ‰¶æ²Ÿç»¼åˆ/g;
            $first_part =~ s/(?i)\Qæ²³å—è¡›è¦–\E/æ²³å—å«è§†/g;
            $first_part =~ s/(?i)\QCETV-\E/CETV/g;
            $first_part =~ s/(?i)\QCCTV-0\E/CCTV-/g;
            $first_part =~ s/(?i)\QCCTV0\E/CCTV-/g;
            $first_part =~ s/(?i)\QCCTV+\E/CCTV-/g;
            $first_part =~ s/(?i)\Qé˜¿æ‹‰ä¼¯è¯­\E/é˜¿è¯­/g;
            $first_part =~ s/(?i)\QCGTNè®°å½•\E/CGTNçºªå½•/g;
            $first_part =~ s/(?i)\Qè¥¿ç­ç‰™è¯­\E/è¥¿è¯­/g;
            $first_part =~ s/(?i)\QCHCé«˜æ¸…$\E/CHCé«˜æ¸…ç”µå½±/g;
            $first_part =~ s/(?i)\QCHCåŠ¨ä½œ$\E/CHCåŠ¨ä½œç”µå½±/g;
            $first_part =~ s/(?i)\QCHCå®¶åº­$\E/CHCå®¶åº­å½±é™¢/g;
            $first_part =~ s/(?i)ä½™å§šç»¼åˆ|å®æ³¢ä½™å§šç»¼åˆ|ä½™å§šæ–°é—»$|ä½™å§šé¢‘é“/ä½™å§šæ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)è±¡å±±ç»¼åˆ|è±¡å±±ç”µè§†å°æ–°é—»ç»¼åˆ|è±¡å±±æ–°é—»$|å®æ³¢è±¡å±±ç»¼åˆ/è±¡å±±æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)åµŠæ³—ç»¼åˆ|ç»å…´åµŠå·ç»¼åˆ|åµŠå·æ–°é—»$/åµŠå·æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)æµ™æ±Ÿé’ç”°|ä¸½æ°´é’ç”°ç»¼åˆ|é’ç”°ç”µè§†$/é’ç”°ç”µè§†å°/g;
            $first_part =~ s/(?i)éƒå¿ç»¼åˆé¢‘é“|æ²³å—éƒå¿ç»¼åˆ/éƒå¿ç»¼åˆ/g;
            $first_part =~ s/(?i)æ­¦æ±‰å…­å°å¤–è¯­|æ­¦æ±‰å¤–è¯­é¢‘é“/æ­¦æ±‰å¤–è¯­/g;
            $first_part =~ s/(?i)æ­¦æ±‰äº”å°æ–‡ä½“|æ­¦æ±‰æ–‡ä½“é¢‘é“/æ­¦æ±‰æ–‡ä½“/g;
            $first_part =~ s/(?i)æ­¦æ±‰å››å°ç»æµ|æ­¦æ±‰ç»æµé¢‘é“/æ­¦æ±‰ç»æµ/g;
            $first_part =~ s/(?i)ç»å…´ç”µè§†å°å…¬å…±|ç»å…´å…¬å…±$/ç»å…´å…¬å…±é¢‘é“/g;
            $first_part =~ s/(?i)æ²³å—ä¹‰é©¬ç”µè§†|ä¹‰é©¬ç”µè§†|ä¹‰é©¬æ–°é—»ç»¼åˆ/ä¹‰é©¬ç»¼åˆ/g;
            $first_part =~ s/(?i)å¶å¿ç”µè§†|å¶å¿|æ²³å—å¶å¿/å¶å¿ç”µè§†å°/g;
            $first_part =~ s/(?i)å®æ³¢ä½™å§šå§šæ±Ÿ|ä½™å§šå§šæ±Ÿ$/ä½™å§šå§šæ±Ÿæ–‡åŒ–/g;
            $first_part =~ s/(?i)ä¸½æ°´äº‘å’Œç»¼åˆ|äº‘å’Œæ–°é—»$/äº‘å’Œæ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)æ¸©å·æ°¸å˜‰ç»¼åˆ|æ°¸å˜‰æ–°é—»$/æ°¸å˜‰æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)æ¾é˜³ç»¼åˆ|ä¸½æ°´æ¾é˜³ç»¼åˆ/æ¾é˜³æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)ç»å…´ä¸Šè™ç»¼åˆ|ä¸Šè™æ–°é—»$/ä¸Šè™æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)è¡¢æ±Ÿæ–°é—»ç»¼åˆ|è¡¢å·è¡¢æ±Ÿç»¼åˆ|è¡¢æ±Ÿæ–°é—»/è¡¢æ±Ÿæ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)æ™®é™€æ–°é—»ç»¼åˆ|æ™®é™€æ–°é—»/æ™®é™€ç”µè§†å°/g;
            $first_part =~ s/(?i)ä¸½æ°´é¾™æ³‰ç»¼åˆ|é¾™æ³‰æ–°é—»$/é¾™æ³‰æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)è¡¢å·å¼€åŒ–å›½å®¶å…¬å›­|å¼€åŒ–å…¬å›­/å¼€åŒ–å›½å®¶å…¬å›­/g;
            $first_part =~ s/(?i)ç¼™äº‘ç»¼åˆ|ä¸½æ°´ç¼™äº‘ç»¼åˆ/ç¼™äº‘æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)å’¸é˜³-1å°|å’¸é˜³-1/å’¸é˜³ç»¼åˆ/g;
            $first_part =~ s/(?i)æ±‰ä¸­-3å°|æ±‰ä¸­-3/æ±‰ä¸­3/g;
            $first_part =~ s/(?i)å®‰å¾½ä½“è‚²/å®‰å¾½ç»¼è‰ºä½“è‚²/g;
            $first_part =~ s/(?i)é£äº‘.è¶³çƒ/é£äº‘è¶³çƒ/g;
            $first_part =~ s/(?i)å’ªè¶³IPV6/å’ªå’•è¶³çƒ/g;
            $first_part =~ s/(?i)æ²³å—æ°‘ç”Ÿé¢‘é“/æ²³å—æ°‘ç”Ÿ/g;
            $first_part =~ s/(?i)è¡¢å·é¾™æ¸¸ç”Ÿæ´»/é¾™æ¸¸ç”Ÿæ´»å¨±ä¹/g;
            $first_part =~ s/(?i)è¡¢å·é¾™æ¸¸ç»¼åˆ/é¾™æ¸¸æ–°é—»ç»¼åˆ/g;
            $first_part =~ s/(?i)é»‘é¾™æ±Ÿå½±$/é»‘é¾™æ±Ÿå½±è§†/g;
            $first_part =~ s/(?i)æµ™æ±Ÿæ•°ç æ—¶ä»£/ä¹‹æ±Ÿçºªå½•/g;
            $first_part =~ s/(?i)æµ™æ±Ÿå…¬å…±æ–°é—»/æµ™æ±Ÿæ–°é—»/g;
            $first_part =~ s/(?i)æµ™æ±Ÿæ°‘ç”Ÿ$/æµ™æ±Ÿæ°‘ç”Ÿä¼‘é—²/g;
            $first_part =~ s/(?i)æµ™æ±Ÿç»æµ$/æµ™æ±Ÿç»æµç”Ÿæ´»/g;
            $first_part =~ s/(?i)æµ™æ±Ÿæ•™ç§‘$/æµ™æ±Ÿæ•™ç§‘å½±è§†/g;
            $first_part =~ s/(?i)æ²³å—ç„¦ä½œ/ç„¦ä½œ/g;
            $first_part =~ s/(?i)NEWTVç¯çƒç²¾é€‰/èšé²¨ç¯çƒç²¾é€‰/g;
            $first_part =~ s/(?i)æ²³å—æ–°å¿ç»¼åˆ/æ–°å¿ç»¼åˆ/g;

            # å°†å¤„ç†åçš„ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†é‡æ–°ç»„åˆ     CCTV-|CCTV|
            $_ = $first_part . $rest . "\n";  # æ˜¾å¼æ·»åŠ æ¢è¡Œç¬¦
        ' tvboxlist/iptvFormatOutput5.txt > tvboxlist/iptvTempOutput.txt
        # sed -i -E 's/^(CCTV)([0-9]+)(.*,.*)/\1-\2\3/' tvboxlist/iptvTempOutput.txt
        # sed -i -E 's/^(CCTV-[0-9]+)[^0-9,]*(,.*)/\1\2/' tvboxlist/iptvTempOutput.txt
        # sed -i -E 's/^(CCTV-)([^0-9,]+)(,.*)/\2\3/' tvboxlist/iptvTempOutput.txt
        # sed -i -E 's/^(CCTV)([^0-9,]+)(,.*)/\2\3/' tvboxlist/iptvTempOutput.txt
        sed -i -E '
          # å¤„ç† CCTV åè·Ÿæ•°å­—ï¼ˆæ·»åŠ è¿å­—ç¬¦å¹¶æ¸…ç†åç»­éæ•°å­—ï¼‰
          s/^(CCTV)([0-9]+)(.*,.*)/\1-\2\3/;
          # å¤„ç† CCTV-æ•°å­— åè·Ÿéæ•°å­—ï¼ˆæ¸…ç†å¤šä½™å†…å®¹ï¼‰
          s/^(CCTV-[0-9]+)[^0-9,]*(,.*)/\1\2/;
          # å¤„ç† CCTV- åè·Ÿéæ•°å­—ï¼ˆåˆ é™¤ CCTV- å‰ç¼€ï¼‰
          s/^(CCTV-)([^0-9,]+)(,.*)/\2\3/;
          # å¤„ç† CCTV åè·Ÿéæ•°å­—ï¼ˆåˆ é™¤ CCTV å‰ç¼€ï¼‰
          s/^(CCTV)([^0-9,]+)(,.*)/\2\3/
        ' tvboxlist/iptvTempOutput.txt

        awk -F'$' '{sub(/^[ \t]+|[ \t]+$/, "", $1); if (!seen[$1]++) print}' "tvboxlist/iptvTempOutput.txt" > "tvboxlist/iptvDeduplicationOutput.txt"
        
    - name: Apply åº”ç”¨
      run: |
        # å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ Emojiï¼Œå…¶ä¸­åŒ…å«äº†å¤šä¸ªä¸åŒçš„ emoji è¡¨æƒ…
        Emoji=("ğŸ‰" "ğŸ¤" "âœ¨" "ğŸ" "ğŸˆ" "ğŸ„" "ğŸ¨" "ğŸ’‹" "ğŸ“" "ğŸ•" "ğŸ‰" "ğŸ’" "ğŸŒ´" "ğŸš€" "ğŸ›¸" "ğŸ—½" "â›…" "ğŸŒˆ" "ğŸ”¥" "â›„" "ğŸ¶" "ğŸ…" "ğŸ¦„" "ğŸ¤")
        # å°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ° Git æš‚å­˜åŒº
        git add .
        # åˆ›å»ºä¸€ä¸ªæäº¤ï¼ŒåŒ…å«äº†éšæœºé€‰æ‹©çš„ emoji å’Œå½“å‰æ—¥æœŸæ—¶é—´ä½œä¸ºæäº¤ä¿¡æ¯
        git commit -m "${Emoji[$[$RANDOM % ${#Emoji[@]}]]} Sync $(date +%Y-%m-%d" "%H:%M:%S)"
        # æ’¤é”€ä¸Šä¸€æ¬¡æäº¤ï¼Œä½†ä¿ç•™æ›´æ”¹
        git reset --soft HEAD^
        git add .
        git commit -m "${Emoji[$[$RANDOM % ${#Emoji[@]}]]} Sync $(date +%Y-%m-%d" "%H:%M:%S)"
        # å¼ºåˆ¶æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“
        git push -f

    - name: Delete workflow runs åˆ é™¤å·¥ä½œæµè¿è¡Œ
      uses: Mattraks/delete-workflow-runs@main
      continue-on-error: true
      with:
        retain_days: 1
        keep_minimum_runs: 3
